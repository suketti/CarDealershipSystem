<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autó Részletei</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <script src="header.js" defer></script>
    </header>
    <div class="lightbox-overlay" id="lightbox-overlay">
        <img class="lightbox-image" id="lightbox-image">
        <button class="nav-arrow left-arrow">&lt;</button>
        <button class="nav-arrow right-arrow">&gt;</button>
        <button class="close-button">X</button>
    </div>
    <section class="car-details">
        <div class="image-gallery">
            <img id="main-car-image" src="kep1.jpg" alt="Autó képe">
            <div class="thumbnail-container">
                <button class="scroll-button left-scroll">&lt;</button>
                <div class="thumbnails">
                    <img src="Képek/kep1.jpg" alt="Kép 1" class="thumbnail">
                    <img src="Képek/kep2.jpg" alt="Kép 2" class="thumbnail">
                    <img src="kep3.jpg" alt="Kép 3" class="thumbnail">
                    <img src="kep4.jpg" alt="Kép 4" class="thumbnail">
                    <img src="kep5.jpg" alt="Kép 5" class="thumbnail">
                    <img src="kep6.jpg" alt="Kép 6" class="thumbnail">
                    <!-- auto_reszletek.html - A képgaléria részhez add hozzá ezt -->
                    
                </div>
                <button class="scroll-button right-scroll">&gt;</button>
            </div>
        </div>
        <div class="details">
            <button class="btn-save" id="save-car">Autó mentése</button>
            <h2 id="car-title"></h2>
            <p id="car-price"></p>
            <p id="car-year"></p>
            <p id="car-type"></p>
            <p id="car-fuel"></p>
            <p class="description" id="car-description"></p>
            <a href="kezdolap.html" class="btn-back">Vissza a Kezdőlapra</a>
    
            <!-- Időpont foglaló űrlap -->
            <div class="calendar-container">
                <h3>Időpont foglalása</h3>
                <div class="calendar">
                    <div class="calendar-header">
                        <button id="prev-month">&#9665;</button>
                        <span id="current-month-year"></span>
                        <button id="next-month">&#9655;</button>
                    </div>
                    <table class="calendar-table">
                        <thead>
                            <tr>
                                <th>H</th><th>K</th><th>Sze</th><th>Cs</th><th>P</th><th>Szo</th><th>V</th>
                            </tr>
                        </thead>
                        <tbody id="calendar-body"></tbody>
                    </table>
                </div>
                <div class="time-picker">
                    <label for="hours">Óra:</label>
                    <select id="hours"></select>
                    <label for="minutes">Perc:</label>
                    <select id="minutes"></select>
                </div>
                <button type="button" class="btn-submit">Foglalás</button>
                <p id="booking-message" style="margin-top: 20px; font-weight: bold;"></p>
            </div>
        </div>
    </section>
    <section id="car-location">
        <h3>Autó elhelyezkedése</h3>
        <div class="map-container">
            <img src="Képek/magyarorszag-terkep.jpg" alt="Magyarország térképe" class="map-image">
            <button id="map-location" class="map-point" disabled></button>
        </div>
    </section>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
    // 1. Autó adatok betöltése
    const params = new URLSearchParams(window.location.search);
    const carData = JSON.parse(params.get("car"));
    
    

    if (carData) {
        document.getElementById("car-title").textContent = `${carData.marka} ${carData.modell}`;
        document.getElementById("main-car-image").src = carData.kep; // Frissítve a nagy kép forrása
        document.getElementById("car-price").textContent = `Ár: ${carData.ar.toLocaleString()} Ft`;
        document.getElementById("car-year").textContent = `Évjárat: ${carData.ev}`;
        document.getElementById("car-type").textContent = `Kivitel: ${carData.kivitel}`;
        document.getElementById("car-fuel").textContent = `Üzemanyag: ${carData.uzemanyag}`;
        document.getElementById("car-description").textContent = carData.leiras || "Nincs leírás az autóról.";

        // Térkép helyzet beállítása
        const locationMap = {
            "Budapest": {top: "40%", left: "45%"},
            "Debrecen": {top: "37%", left: "80%"},
            "Miskolc": {top: "20%", left: "70%"},
            "Sopron": {top: "36%", left: "10%"}
        };

        const mapButton = document.getElementById("map-location");
        if (carData.varos && locationMap[carData.varos]) {
            mapButton.style.top = locationMap[carData.varos].top;
            mapButton.style.left = locationMap[carData.varos].left;
            mapButton.textContent = carData.varos;
        }
    }

    // 2. Naptár és időpontfoglalás inicializálása
    const calendarBody = document.getElementById("calendar-body");
    const currentMonthYear = document.getElementById("current-month-year");
    const prevMonthBtn = document.getElementById("prev-month");
    const nextMonthBtn = document.getElementById("next-month");
    const hoursSelect = document.getElementById("hours");
    const minutesSelect = document.getElementById("minutes");
    const bookingMessage = document.getElementById("booking-message");
    let selectedDate = null;
    let currentDate = new Date();

    // Naptár renderelése
    function renderCalendar() {
    calendarBody.innerHTML = "";
    currentMonthYear.textContent = currentDate.toLocaleDateString("hu-HU", { month: "long", year: "numeric" });

    const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1).getDay();
    const lastDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0).getDate();
    let today = new Date();
    let day = 1;

    for (let i = 0; i < 6; i++) {
        const row = document.createElement("tr");
        let hasDays = false;
        for (let j = 0; j < 7; j++) {
            const cell = document.createElement("td");
            if ((i === 0 && j < (firstDay === 0 ? 6 : firstDay - 1)) || day > lastDate) {
                cell.textContent = "";
            } else {
                cell.textContent = day;
                cell.classList.add("calendar-day");

                let cellDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
                
                // Ha a nap már elmúlt, pirosra színezzük és kikapcsoljuk a kattinthatóságot
                if (cellDate < today.setHours(0,0,0,0)) {
                    cell.classList.add("past-date");
                } else {
                    cell.addEventListener("click", () => {
                        document.querySelectorAll(".calendar-day").forEach(e => e.classList.remove("selected"));
                        cell.classList.add("selected");
                        selectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), parseInt(cell.textContent));
                    });
                }
                day++;
                hasDays = true;
            }
            row.appendChild(cell);
        }
        if (hasDays) calendarBody.appendChild(row);
    }
}

const saveButton = document.getElementById('save-car');
if (carData) {
    const isLoggedIn = document.querySelector('.profile-btn') !== null;

    saveButton.addEventListener('click', () => {
        const savedCars = JSON.parse(localStorage.getItem('savedCars') || '[]');
        
        // Egyedi azonosítás kép URL alapján
        const exists = savedCars.some(car => car.kep === carData.kep);
        if (!exists) {
            savedCars.push(carData);
            localStorage.setItem('savedCars', JSON.stringify(savedCars));
            alert('Autó sikeresen mentve!');
        } else {
            alert('Ez az autó már mentve van!');
        }
    });
}

const existingBooking = localStorage.getItem('bookingDate');
if(existingBooking) {
    document.querySelector('.btn-submit').disabled = true;
    bookingMessage.textContent = `✅ Már van foglalt időpontja: ${existingBooking}`;
    bookingMessage.style.color = "green";
}
    // Időválasztók feltöltése
    function populateTimePickers() {
    hoursSelect.innerHTML = "";
    minutesSelect.innerHTML = "";

    let today = new Date();
    let selectedDay = selectedDate ? selectedDate.setHours(0, 0, 0, 0) : null;
    let isToday = selectedDay === today.setHours(0, 0, 0, 0);
    let currentHour = today.getHours();
    let currentMinute = today.getMinutes();

    for (let hour = 8; hour < 18; hour++) {
        const option = document.createElement("option");
        option.value = hour;
        option.textContent = hour;
        if (isToday && hour < currentHour) {
            option.disabled = true;
            option.style.color = "#999";
        }
        hoursSelect.appendChild(option);
    }

    for (let minute = 0; minute < 60; minute += 15) {
        const option = document.createElement("option");
        option.value = minute;
        option.textContent = minute.toString().padStart(2, "0");
        if (isToday && hoursSelect.value == currentHour && minute < currentMinute) {
            option.disabled = true;
            option.style.color = "#999";
        }
        minutesSelect.appendChild(option);
    }
}
hoursSelect.addEventListener("change", populateTimePickers);


    // Gombok eseményei
    prevMonthBtn.addEventListener("click", () => {
        currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1);
        renderCalendar();
    });

    nextMonthBtn.addEventListener("click", () => {
        currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1);
        renderCalendar();
    });

    document.querySelector(".btn-submit").addEventListener("click", (e) => {
    const isLoggedIn = document.querySelector('.profile-btn') !== null;
    if (!isLoggedIn) {
        e.preventDefault();
        const modal = document.getElementById('login-modal');
        const overlay = document.getElementById('overlay');
        if (modal && overlay) {
            modal.style.display = 'block';
            overlay.style.display = 'block';
            document.querySelectorAll(".content, header, .filter, .inventory, footer").forEach(el => {
                el.classList.add("blurred");
            });
            bookingMessage.textContent = "Kérem, előbb jelentkezzen be!";
        }
        return;
    }

    if (!selectedDate) {
        bookingMessage.textContent = "❌ Válasszon dátumot!";
        bookingMessage.style.color = "red";
        return;
    }
    const existingBooking = localStorage.getItem('bookingDate');
    if(existingBooking) {
        bookingMessage.textContent = "❌ Csak egy időpont foglalható!";
        bookingMessage.style.color = "red";
        return;
    }
    const today = new Date();
    today.setHours(0, 0, 0, 0);
    let selectedDateTime = new Date(selectedDate);
    selectedDateTime.setHours(hoursSelect.value, minutesSelect.value, 0, 0);

    if (selectedDateTime < new Date()) {
        bookingMessage.textContent = "❌ Nem lehet múltbeli időpontot foglalni!";
        bookingMessage.style.color = "red";
        return;
    }

    const bookingDate = `${selectedDate.toLocaleDateString("hu-HU")} ${hoursSelect.value}:${minutesSelect.value}`;
    localStorage.setItem('bookingDate', bookingDate);
    bookingMessage.textContent = `✅ Foglalt időpont: ${bookingDate}`;
    bookingMessage.style.color = "green";

    const newMessage = {
        sender: "Rendszer",
        date: new Date().toLocaleDateString("hu-HU"),
        content: `Sikeres időpontfoglalás: ${bookingDate}`
    };
    let messages = JSON.parse(localStorage.getItem('messages') || '[]');
    messages.push(newMessage);
    localStorage.setItem('messages', JSON.stringify(messages));
});

    // 3. Képgaléria inicializálása
    const mainImage = document.getElementById("main-car-image");
    const thumbnails = document.querySelectorAll(".thumbnail");
    const thumbnailsContainer = document.querySelector(".thumbnails");
    const leftScrollButton = document.querySelector(".left-scroll");
    const rightScrollButton = document.querySelector(".right-scroll");

    // Alapértelmezett kép beállítása
    if (thumbnails.length > 0) {
        mainImage.src = thumbnails[0].src;
    }

    // Kis képek kattintásának kezelése
    thumbnails.forEach(thumbnail => {
        thumbnail.addEventListener("click", () => {
            mainImage.src = thumbnail.src;
        });
    });

    // Görgetés kezelése
    let scrollPosition = 0;
    const scrollStep = 60;

    leftScrollButton.addEventListener("click", () => {
        scrollPosition = Math.max(scrollPosition - scrollStep, 0);
        thumbnailsContainer.style.transform = `translateX(-${scrollPosition}px)`;
    });

    rightScrollButton.addEventListener("click", () => {
        const maxScroll = thumbnailsContainer.scrollWidth - thumbnailsContainer.clientWidth;
        scrollPosition = Math.min(scrollPosition + scrollStep, maxScroll);
        thumbnailsContainer.style.transform = `translateX(-${scrollPosition}px)`;
    });

    const lightboxOverlay = document.getElementById("lightbox-overlay");
    const lightboxImage = document.getElementById("lightbox-image");
    let currentImageIndex = 0;

    // Lightbox megnyitása
    mainImage.addEventListener("click", () => {
        lightboxOverlay.style.display = "flex";
        lightboxImage.src = mainImage.src;
    });

    // Képek váltása
    const changeImage = (direction) => {
        const images = Array.from(thumbnails).map(t => t.src);
        currentImageIndex = (currentImageIndex + direction + images.length) % images.length;
        lightboxImage.src = images[currentImageIndex];
    };

    // Eseménykezelők
    document.querySelector(".left-arrow").addEventListener("click", (e) => {
        e.stopPropagation();
        changeImage(-1);
    });

    document.querySelector(".right-arrow").addEventListener("click", (e) => {
        e.stopPropagation();
        changeImage(1);
    });

    document.querySelector(".close-button").addEventListener("click", () => {
        lightboxOverlay.style.display = "none";
    });

    lightboxOverlay.addEventListener("click", (e) => {
        if (e.target === lightboxOverlay) {
            lightboxOverlay.style.display = "none";
        }
    });

    // Billentyűzet kezelése
    document.addEventListener("keydown", (e) => {
        if (lightboxOverlay.style.display === "flex") {
            if (e.key === "ArrowLeft") changeImage(-1);
            if (e.key === "ArrowRight") changeImage(1);
            if (e.key === "Escape") lightboxOverlay.style.display = "none";
        }
    });

    // Thumbnail kattintások kezelése
    thumbnails.forEach((thumbnail, index) => {
        thumbnail.addEventListener("click", () => {
            currentImageIndex = index;
            lightboxImage.src = thumbnail.src;
        });
    });



    // Inicializálások
    renderCalendar();
    populateTimePickers();
});
    </script>
<footer>
    <script src="footer.js"></script>
</footer>
</body>
</html>
